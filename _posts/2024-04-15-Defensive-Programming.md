---
layout: post
title: é˜²å¾¡å¼ç¼–ç¨‹
categories: [Architect]
description: é˜²å¾¡æ€§ç¼–ç¨‹çš„ç›®çš„å§‹ç»ˆæ˜¯æé«˜ä»£ç è´¨é‡ï¼Œé™ä½çº¿ä¸Šå‡ºç°é—®é¢˜çš„æ¦‚ç‡ã€‚
keywords: é˜²å¾¡å¼ç¼–ç¨‹
mermaid: false
sequence: false
flow: false
mathjax: false
mindmap: false
mindmap2: false
topmost: false
---

## å‰è¨€

#### ç¼–å†™é«˜è´¨é‡ä»£ç æœ‰ä»€ä¹ˆç”¨ï¼Ÿ
ä½œä¸ºä¸€åç¨‹åºçŒ¿ï¼Œæˆ–è½¯ä»¶å¼€å‘å·¥ç¨‹å¸ˆï¼Œæˆ–æŠ€æœ¯å·¥äººï¼Œé¦–è¦ä»»åŠ¡å°±æ˜¯ç¼–å†™å¥½ä»£ç (ç¼–å†™é«˜è´¨é‡ä»£ç )ã€‚é‚£ä¹ˆç¼–å†™å¥½ä»£ç æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿé ç¼–å†™å¥½ä»£ç å¯ä»¥ç»´æŒä½ çš„å·¥ä½œï¼ˆåŸºç¡€ï¼‰ï¼Œå¯ä»¥å»å½±å“ä½ çš„åŒäº‹å’Œé¢†å¯¼ï¼ˆè®©ä½ åŒäº‹å’Œé¢†å¯¼ä»ä»£ç ä¸­è®¤ä¸ºä½ æ˜¯ä¸€ä¸ªæŠ€æœ¯èƒ½åŠ›é è°±çš„äººï¼‰ï¼ˆè¿›é˜¶ï¼‰ï¼Œé‚£ä¹ˆç»§ç»­ä¸‹å»ï¼Œä½ å¯èƒ½å‚ä¸å›¢é˜Ÿæˆ–éƒ¨é—¨æˆ–å…¬å¸é‡è¦çš„é¡¹ç›®æˆ–äº‹æƒ…ï¼ˆé«˜çº§ï¼‰ï¼Œå†ä¸‹å»ï¼Œä½ å°±å¯ä»¥åœ¨å›¢é˜Ÿå’Œéƒ¨é—¨ä¸­æé«˜ä½ çš„æŠ€æœ¯å½±å“åŠ›ï¼Œä»è€Œä½ æ›´æœ‰æœºä¼šè·å¾—æ›´å¤šçš„èµ„æºï¼ˆæ—¶é—´å’ŒäººåŠ›ï¼‰å’Œæ›´å¤šçš„æˆå°±ï¼ˆå‡èŒå’ŒåŠ è–ªï¼‰ã€‚å½“ç„¶ï¼Œä¹Ÿæœ‰å¯èƒ½åœ¨ä½ å·¥ä½œçš„ç¯å¢ƒä¸­ï¼Œç¼–å†™å¥½ä»£ç å’Œç¼–å†™åä»£ç ç»“æœä¸€æ ·ã€‚é‚£ä¹ˆï¼Œå°½æ—©ç¦»å¼€ï¼Œå»è¿½å¯»ä½ æƒ³è¦çš„ç¼–å†™å¥½ä»£ç çš„å·¥ä½œç¯å¢ƒã€‚

ç¼–å†™é«˜è´¨é‡ä»£ç é‡è¦çš„ä¸€ç¯ï¼šé˜²å¾¡å¼ç¼–ç¨‹ã€‚

#### é˜²å¾¡å¼ç¼–ç¨‹æ˜¯ä»€ä¹ˆï¼Ÿ

é˜²å¾¡å¼ç¼–ç¨‹ï¼ˆDefensive Programmingï¼‰æ˜¯ä¸€ç§ç¼–ç¨‹å®è·µæˆ–ç¼–ç¨‹èŒƒå¼ï¼Œé€šè¿‡åœ¨ä»£ç ä¸­æ·»åŠ é˜²å¾¡æ€§çš„é€»è¾‘å’Œé”™è¯¯å¤„ç†æœºåˆ¶ï¼Œæ¥é™ä½è½¯ä»¶å‡ºç°é”™è¯¯æˆ–å¼‚å¸¸çš„æ¦‚ç‡ï¼Œä»è€Œæé«˜è½¯ä»¶çš„æ­£ç¡®è¡Œã€ç¨³å®šæ€§ã€å®‰å…¨æ€§ï¼Œè®©è½¯ä»¶æ›´å¥å£®ã€‚

å…¶å®ï¼Œé˜²å¾¡å¼ç¼–ç¨‹å°±æ˜¯åœ¨ç¼–å†™ä»£ç çš„æ—¶å€™ï¼Œå‡è®¾ä»£ç å‘¨å›´çš„ç¯å¢ƒï¼ˆä»»ä½•è¾“å…¥å’Œè¾“å‡ºç­‰ï¼‰éƒ½æ˜¯ä¸å¯ä¿¡çš„ï¼Œç„¶åé‡‡å–é¢„é˜²æ€§æªæ–½é¿å…æ½œåœ¨çš„é”™è¯¯æˆ–å¼‚å¸¸ã€‚


#### é˜²å¾¡å¼ç¼–ç¨‹çš„ç›®çš„æ˜¯ä»€ä¹ˆï¼Ÿ

ç›®çš„å¾ˆç®€å•ï¼Œå°±æ˜¯ä¿æŠ¤è‡ªå·±ï¼ˆæ²¡æœ‰crashï¼Œæ²¡æœ‰ç¦»è°±çš„é”™è¯¯ï¼Œæ²¡æœ‰ç”©é”…ç­‰ğŸ¶ï¼‰ï¼Œä¸ç®¡ä½ å†™çš„ä»£ç æ˜¯ç»™è‡ªå·±ç”¨è¿˜æ˜¯ç»™åˆ«äººç”¨ï¼Œåœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½éœ€è¦ä¿è¯ä»£ç çš„æ­£ç¡®æ€§å’Œå¯é æ€§-å¥å£®ã€‚

## é˜²å¾¡å¼ç¼–ç¨‹

é˜²å¾¡æ€§ç¼–ç¨‹è¯¥æ€ä¹ˆåšï¼Ÿåœ¨ã€Šä»£ç å¤§å…¨2ã€‹ä¸­æåˆ°äº†ï¼š

1. ä¿æŠ¤ç¨‹åºå…é­éæ³•è¾“å…¥æ•°æ®çš„ç ´å
2. æ–­è¨€
3. é”™è¯¯å¤„ç†æŠ€æœ¯
4. å¼‚å¸¸
5. éš”ç¦»ç¨‹åºï¼Œä½¿ä¹‹åŒ…å®¹ç”±é”™è¯¯é€ æˆçš„æŸå®³
6. è¾…åŠ©è°ƒè¯•çš„ä»£ç 
7. ç¡®å®šåœ¨äº§å“ä»£ç ä¸­è¯¥ä¿ç•™å¤šå°‘é˜²å¾¡å¼ä»£ç 
8. å¯¹é˜²å¾¡å¼ç¼–ç¨‹é‡‡å–é˜²å¾¡çš„å§¿æ€

æ ¹æ®è¿™å…«ä¸ªæ–¹é¢ï¼Œä»¥åŠä¸ªäººåœ¨å®é™…é¡¹ç›®ä¸­ç§¯ç´¯çš„ä¸€äº›çœŸå®ç»éªŒã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹å‡ ç‚¹æ¥åšé˜²å¾¡æ€§ç¼–ç¨‹ï¼š
1. è¾“å…¥éªŒè¯
2. è¾“å‡ºéªŒè¯
3. å¼‚å¸¸
4. æ—¥å¿—
5. æµ‹è¯•ä¿éšœ
6. ab å¼€å…³

é€šè¿‡è¿™å‡ ç‚¹ï¼Œèƒ½æœ‰æ•ˆçš„é¢„é˜²çº¿ä¸Šå‡ºç° crashã€‚

### è¾“å…¥éªŒè¯

å½“åœ¨ç¼–å†™ä¸€ä¸ªæ–¹æ³•çš„æ—¶å€™ï¼Œå¤–éƒ¨è¾“å…¥å‚æ•°çš„å€¼ï¼Œå¯ä»¥æ˜¯ä»»æ„çš„ã€éšæ„çš„ã€ä¸ç¡®å®šçš„å€¼ã€‚é‚£ä¹ˆï¼Œç¼–å†™æ–¹æ³•é¦–å…ˆéœ€è¦æ ¡éªŒå‚æ•°å€¼ã€‚

æ£€éªŒå‚æ•°å€¼çš„å‡†åˆ™å¤§æ¦‚æœ‰ï¼š
* æ˜¯å¦ä¸º null
* æ˜¯å¦åœ¨æœ‰æ•ˆèŒƒå›´å†…
* æ˜¯å¦ç¬¦åˆé¢„æœŸçš„æ ¼å¼

ä¸‹é¢ç®€å•ä»‹ç»å‡ ç§æ–¹å¼æ¥æ£€éªŒæ–¹æ³•å‚æ•°å€¼ã€‚

#### åŸºç¡€ç±»å‹éªŒè¯
1. æ™®é€šéªŒè¯

```java
public void checkIntArgs(int a){
  //æ­£è´Ÿæ•°éªŒè¯
  if(a<0) return;
  
  //è¿›åº¦éªŒè¯
  if(a>=0 && a<=100){
  
  }
}

```
2.  ä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£`@IntDef`ã€`@StringDef`é™å®šå¸¸é‡å‚æ•°
```java

@IntDef({WeekDays.MONDAY, WeekDays.TUESDAY, WeekDays.WEDNESDAY, WeekDays.THURSDAY, WeekDays.FRIDAY, WeekDays.SATURDAY, WeekDays.SUNDAY})
@Retention(value = RetentionPolicy.SOURCE)
public @interface WeekDays {
    int MONDAY = 1;
    int TUESDAY = 2;
    int WEDNESDAY = 3;
    int THURSDAY = 4;
    int FRIDAY = 5;
    int SATURDAY = 6;
    int SUNDAY = 7;
}


public class Day {
    private @WeekDays int currentDay;

    public Day() {
    }

    @WeekDays
    public int getCurrentDay() {
        return currentDay;
    }
    //å¦‚æœ currentDay ä¸æ˜¯ WeekDaysï¼Œé‚£ä¹ˆç¼–è¯‘å™¨å°±ä¼šæŠ¥é”™
    public void setCurrentDay(@WeekDays int currentDay) {
        this.currentDay = currentDay;
    }
}
```
3. ä½¿ç”¨åº“ `androidx.annotation`çš„ `@IntRange`ã€`@FloatRange`ã€`@Size`é™å®šå‚æ•°å€¼èŒƒå›´
```java
public void setDayOfMonth(@IntRange(from = 1, to = 31) int day) {
   //è¯´æ˜ day å€¼å¿…é¡»åœ¨ 1åˆ°31 èŒƒå›´å†…ï¼Œå¦åˆ™ç¼–è¯‘å™¨å°±ä¼šæŠ¥é”™
}


public void setProgress(@IntRange(from = 0, to = 100) int progress) {
  //è¯´æ˜ progress å¿…é¡»åœ¨ 0åˆ°100 èŒƒå›´å†…ï¼Œï¼Œå¦åˆ™ç¼–è¯‘å™¨å°±ä¼šæŠ¥é”™
}


public void getLocationInWindow(@Size(2) int[] outLocation){
  //è¯´æ˜ outLocation çš„å¤§å°ä¸º2
}
```
4. ä½¿ç”¨åº“ `androidx.annotation`çš„`@IntegerRes`ã€`@AnimRes`ã€`@StringRes`ç­‰æ³¨è§£é™å®šèµ„æºç±»å‹

```java
public void setDay(@IntegerRes int resId){
   //è¯´æ˜ resId æ˜¯èµ„æºå€¼ï¼Œå¦åˆ™ç¼–è¯‘å™¨å°±ä¼šæŠ¥é”™
}
```

5. float å’Œ double å¯èƒ½ä¼šç²¾åº¦é—®é¢˜ï¼Œæ¯”è¾ƒå’Œè®¡ç®—ä¸èƒ½ç›´æ¥ä½¿ç”¨
```java
public int compareFloat(float a, float b) {
    return Float.compare(a, b);
}

public int compareDouble(double a, double b) {
    return Double.compare(a, b);
}

public float computeFloatAdd(float a, float b) {
    return BigDecimal.valueOf(a).add(BigDecimal.valueOf(b)).floatValue();
}

public double computeDoubleAdd(double a, double b) {
    return BigDecimal.valueOf(a).add(BigDecimal.valueOf(b)).doubleValue();
}
```
6. åŒ…è£…ç±»å‹æœ‰æ¬ºéª—æ€§ï¼Œä¸èƒ½æ‹¿æ¥å°±ç”¨
```java
public void checkIntegerArgs(Integer args) {
    if (args == null) {
        return;
    }
    int value = args;
}

public void checkBooleanArgs(Boolean args) {
    if (args == null) {
        return;
    }
    boolean value = args;
}
```
```java
public void testCheckIntegerArgs() {
    List<Integer> args = new ArrayList<>();
    args.add(-1);
    args.add(0);
    args.add(1);
    checkIntegerArgs(args);
}

public void checkIntegerArgs(@NonNull List<Integer> args) {
    int removeValue = 1;
    args.remove(removeValue);
    //ç§»é™¤çš„å¹¶ä¸æ˜¯1ï¼Œè€Œæ˜¯0ã€‚å› ä¸ºè°ƒç”¨çš„æ˜¯args.remove(int index)ï¼Œä¸æ˜¯args.remove(Object o)
}
```
å°ç»“ï¼šå¤šç”¨æ³¨è§£çº¦æŸå‚æ•°ï¼ŒAndroid æä¾›äº†æ³¨è§£åº“ `androidx.annotation`ã€‚é˜…è¯» Activity æˆ– Fragment æºç ï¼Œå¯ä»¥å‘ç°æœ‰å¾ˆå¤šæ³¨è§£åº“ `androidx.annotation`ç›¸å…³ä½¿ç”¨ã€‚

#### å¯¹è±¡ç±»å‹éªŒè¯
1. ä½¿ç”¨åº“ `androidx.annotation`çš„`@Nullbale`ã€`@NonNull`æ³¨è§£é™å®šå¯¹è±¡å¯ç©ºå’Œä¸å¯ç©º
```java

public void sendMessage(@Nullable Person person) {
    //å¯ç©ºå¯¹è±¡
}

public void sendMessage(@NonNull Person person) {
   //ä¸å¯ç©ºå¯¹è±¡
}
```
å¦‚æœæ˜¯ä½¿ç”¨ kotlin çš„ `?` æ¥é™å®šå¯¹è±¡å¯ç©ºå’Œä¸å¯ç©ºï¼Œæœ€å¥½ä¹Ÿæ·»åŠ æ³¨è§£ã€‚å› ä¸ºæ··åˆå¼€å‘é¡¹ç›®ä¸­ï¼Œ å­˜åœ¨Java å’Œ Kotlin ä»£ç äº’ç›¸è°ƒç”¨ã€‚

æˆ–è€…ä½¿ç”¨ `java.util.Optional`å¯¹ä¼ å…¥å‚æ•°å¯¹è±¡åŒ…è£…ï¼š
```java
public void sendMessage(Person person) {
    String name = Optional.ofNullable(person).map(new Function<Person, String>() {

        @Override
        public String apply(Person person) {
            return person.getName();
        }
    }).orElse("unknown");
}
```

3. å¯¹è±¡å¯è¯»å¯å†™
```java
public class Person {
    private String name;

    public Person(String name) {
        this.name = name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public String getName() {
        return this.name;
    }
}

public void setPersonaName(@NonNull Person person) {
    //æ‹¿åˆ° Person å¯¹è±¡ï¼Œé¦–å…ˆçœ‹ Person æºç ï¼Œåˆ¤æ–­å…¶å¯è¯»ã€å¯å†™
    //å¤–éƒ¨å’Œå†…éƒ¨éƒ½å¯æ›´æ”¹ person.nameï¼Œéœ€æ³¨æ„ perosn.name çš„å‡†ç¡®æ€§
    person.setName("xxx");
}
```
å¯¹äº `sendMessage`æ–¹æ³•ä¸­çš„ Person å‚æ•°å¯¹è±¡ï¼Œä½¿ç”¨æ—¶éœ€è¦æ³¨æ„ï¼š
   * æ‹¿åˆ° Person å¯¹è±¡ï¼Œé¦–å…ˆçœ‹ Person æºç ï¼Œåˆ¤æ–­å…¶å¯è¯»ã€å¯å†™
   * å¤–éƒ¨å’Œå†…éƒ¨éƒ½å¯æ›´æ”¹ person.nameï¼Œé‚£ä¹ˆ perosn.name å¯èƒ½ç¼ºä¹å‡†ç¡®æ€§

2. å¯¹è±¡å¯è¯»ä¸å¯å†™
```java
public final class Person {
    private final String name;

    public Person(String name) {
        this.name = name;
    }
    
    public String getName() {
        return this.name;
    }
}
    public void setPersonaName(Person person) {
        // ä¸æä¾› setName æ–¹æ³•ï¼Œå¦‚æœæ²¡æœ‰å’Œå®šä¹‰ Person çš„ä½œè€…åå•†ï¼Œåˆè¦ä¿®æ”¹ nameï¼Œä¸èƒ½ç›´æ¥å» Person ä¸­æ·»åŠ  setName æ–¹æ³•ï¼Œå› ä¸ºè¿™å¯èƒ½å¯¼è‡´å¤–éƒ¨ä½¿ç”¨çš„ person.name å¤±å»å‡†ç¡®æ€§
        person.getName();
    }
```
æˆ–è€…æä¾› Builder
```java
public final class Person {
    private String name;

    private Person() {
    }

    public String getName() {
        return this.name;
    }

    public class Builder {
        private String name;

        public Builder setName(String name) {
            this.name = name;
            return this;
        }

        public Person build() {
            Person person = new Person();
            person.name = this.name;
            return person;
        }
    }
}

public void setPersonaName(Person person) {
    // ä¸æä¾› setName æ–¹æ³•
    person.getName();
}

```
å¯¹äº `sendMessage`æ–¹æ³•ä¸­çš„ Person å‚æ•°å¯¹è±¡ï¼Œä½¿ç”¨æ—¶éœ€è¦æ³¨æ„ï¼šPerson å¯¹è±¡ä¸æä¾› setName æ–¹æ³•ï¼Œ**å¦‚æœæ²¡æœ‰å’Œå®šä¹‰ Person çš„ä½œè€…åå•†ï¼Œåˆè¦ä¿®æ”¹ nameï¼Œæ˜¯ä¸èƒ½ç›´æ¥å» Person ä¸­æ·»åŠ  setName æ–¹æ³•**ï¼Œå› ä¸ºè¿™å¯èƒ½å¯¼è‡´å¤–éƒ¨ä½¿ç”¨çš„ person.name å¤±å»å‡†ç¡®æ€§ã€‚

3. å¯¹è±¡æ‹·è´ï¼Œé˜²æ­¢å—åˆ°å¤–éƒ¨ä¿®æ”¹çš„å½±å“
```java
public final class Period {
    private final Date start;
    private final Date end;

    public Period(Date start, Date end) {
        this.start = start;
        this.end = end;
    }

    public Date getStart() {
        return this.start;
    }

    public Date getEnd() {
        return this.end;
    }
}

Data å¯ä»¥ä¿®æ”¹å®ƒçš„ time: start.setTime(System.currentTimeMillis());æ‰€ä»¥ä¸Šé¢ä»£ç éœ€è¦æ›´æ”¹ä¸ºï¼š

public Period(Date start, Date end) {
    this.start = new Date(start.getTime());
    this.end = new Date(end.getTime());
}
```
è¡¨é¢çœ‹ Date start å’Œ Date end å¯¹è±¡éƒ½æ˜¯å¯è¯»ä¸å¯å†™ï¼Œä½†å…¶å® start å’Œ end å¯¹è±¡æ˜¯å¯å†™çš„ï¼š`start.setTime(System.currentTimeMillis())`ï¼Œæ‰€ä»¥è¦å¯¹å¯¹è±¡è¿›è¡Œä¿æŠ¤æ€§æ‹·è´ã€‚

5. ä½¿ç”¨å¯¹è±¡å‰¯æœ¬
```java
public void cloneList(@NonNull List<String> list) {
    List<String> newList = new ArrayList<String>(list);
}

public void unmodifiableList(@NonNull List<String> list) {
    List<String> newList = Collections.unmodifiableList(list);
}

public void cloneArray(@NonNull int[] arr) {
    int[] newArr = Arrays.copyOf(arr, arr.length);
}
```
å¦‚æœä¸æ˜ç¡®å¤–éƒ¨ä¼ å…¥çš„é›†åˆæˆ–æ•°ç»„å¯¹è±¡æ˜¯å¦å¯ä¿®æ”¹ï¼Œé‚£ä¹ˆå°±ä½¿ç”¨è¯¥é›†åˆæˆ–æ•°ç»„å¯¹è±¡çš„å‰¯æœ¬ã€‚Kotlin ä¸­åŒºåˆ†äº†é›†åˆçš„å¯è¯»å’Œå¯å†™ï¼š`Collection`ï¼Œ`MutableCollection`ã€‚

4. æ¶ˆåŒ–ä¸äº†çš„æ–‡ä»¶
```java
@Nullable
public String getStringFromFile(@NonNull String filePath) {
    //å¦‚æœ filePath å¯¹åº”çš„æ–‡ä»¶è¿‡å¤§ï¼Œå°±ä¸è¦è¯»å–
    File file = new File(filePath);
    long max = 10 * 1024 * 1024L;
    if (!file.exists() || file.length() == 0L || file.length() > max) {
        //æ¶ˆåŒ–ä¸äº†
        return null;
    }
}

@Nullable
public Bitmap getBitmapFromFile(@NonNull String filePath) {
    //å¦‚æœ filePath å¯¹åº”çš„å›¾ç‰‡è¿‡å¤§ï¼Œå°±ä¸è¦è¯»å–
    BitmapFactory.Options options = new BitmapFactory.Options();
    options.inJustDecodeBounds = true;
    BitmapFactory.decodeFile(filePath, options);
    if (options.outWidth == 0 || options.outHeight == 0) {
        return null;
    }
    int max = 1080 * 1920;
    int size = options.outWidth * options.outHeight;
    if (size > max) {
        return nulll;
    }
}
```
ä»æ–‡ä»¶ä¸­è¯»å–å­—ç¬¦ä¸²å†…å®¹ï¼Œæˆ–ä»å›¾ç‰‡æ–‡ä»¶ä¸­è·å–Bitmapï¼Œæˆ–è¯»å–éŸ³é¢‘ã€è§†é¢‘æ–‡ä»¶ï¼Œæˆ–å‹ç¼©å’Œè§£å‹æ–‡ä»¶ï¼Œæˆ–ä¸Šä¼ æ–‡ä»¶ç­‰åœºæ™¯ï¼Œéƒ½éœ€è¦æ³¨æ„æ–‡ä»¶æ˜¯å¦è¿‡å¤§ã€‚

5. æ¶ˆåŒ–ä¸äº†çš„å¤§å¯¹è±¡
```java
public void checkCollectionArgs(@NonNull Collection<String> collection){
    int max = 128;
    if (collection.size() > max) {
        return;
    }
}

public void checkArrayArgs(@Size(128) @NonNull int[] arr) {
    int max = 128;
    if (arr.length > max) {
        return;
    }
}

public void checkStringArgs(@Size(min = 1, max = 256) @NonNull String str) {
    int max = 256;
    if (str.length() > max) {
        return;
    }
}
```
ä¼ å…¥å¤§å¯¹è±¡ï¼Œè¿œè¶…è¿‡äº†è¯¥æ–¹æ³•æ‰¿å—çš„èƒ½åŠ›ï¼Œæ‰€ä»¥éœ€è¦ç¡®å®šæ–¹æ³•æ‰€èƒ½æ¥å—çš„å¯¹è±¡æœ‰æ•ˆèŒƒå›´ã€‚

### è¾“å‡ºéªŒè¯
æ–¹æ³•çš„è¾“å‡ºå€¼ï¼Œä¸»è¦æ˜¯ä¿è¯å…¶æ­£ç¡®æ€§ã€‚

è¿”å›å€¼çš„å‡†åˆ™å¤§æ¦‚æœ‰ï¼š

* é¿å…è¿”å›ç©ºå€¼ï¼šå¦‚æœæ–¹æ³•å¯èƒ½è¿”å›ç©ºå€¼ï¼Œåº”è¯¥åœ¨æ–‡æ¡£æ³¨é‡Šä¸­æ˜ç¡®è¯´æ˜ï¼Œå¹¶è€ƒè™‘é€šè¿‡è¿”å›å¯é€‰ç±»å‹ï¼ˆOptionalï¼‰ã€ç©ºå¯¹è±¡æ¨¡å¼ï¼ˆNull Object Patternï¼‰ç­‰æ–¹å¼æ¥å¤„ç†ã€‚
* ä¸€è‡´æ€§ï¼šè¿”å›å€¼åº”è¯¥åœ¨ä¸åŒçš„è°ƒç”¨æƒ…å†µä¸‹ä¿æŒä¸€è‡´æ€§ã€‚å³ä½¿æ–¹æ³•æ‰§è¡Œçš„ç¯å¢ƒæˆ–å‚æ•°å‘ç”Ÿå˜åŒ–ï¼Œè¿”å›å€¼çš„è¯­ä¹‰å’Œç±»å‹ä¹Ÿåº”è¯¥ä¿æŒä¸å˜ã€‚
* å‡†ç¡®æ€§ï¼šç»™æ–¹æ³•ä¸€ä¸ªè¾“å…¥å‚æ•° xï¼Œé‚£ä¹ˆå®ƒçš„è¾“å‡ºå€¼å°±æ˜¯ y = f(x)ï¼Œæ–¹æ³•çš„é€»è¾‘åœ¨ä»»ä½•è¾“å…¥æ¡ä»¶ä¸‹éƒ½èƒ½äº§ç”Ÿæ­£ç¡®çš„ç»“æœã€‚


1. ä½¿ç”¨åº“ `androidx.annotation`çš„ `@NonNull` å’Œ`@Nullable`æ³¨è§£é™å®šè¿”å›å¯¹è±¡å¯ç©ºå’Œä¸å¯ç©º
```java
@NonNull
public Person getPerson(int id){

}

@Nullable
public Person getPerson(int id){

}
```
æˆ– ä½¿ç”¨ `java.util.Optional` è¿”å›å¯é€‰ç±»å‹
```java
public Optional<Person> getPerson(int id) {
    Person person = db.getPersonById(id);
    return Optional.ofNullable(person);
}
```
æˆ– ç©ºå¯¹è±¡

```java
@NonNull
public Person getPerson(int id) {
    Person person = db.getPersonById(id);
    return person != null ? person ? new Person();
}
```
å¦å¤–ï¼Œå…³äºç©ºå¯¹è±¡æ¨¡å¼ï¼ˆNull Object Patternï¼‰ï¼Œä¸»è¦ç”¨äºå¤šæ€ï¼š

```java
// å®šä¹‰å½¢çŠ¶æ¥å£
interface Shape {
    void draw();
}

// å…·ä½“çš„å®ç°ç±» - åœ†å½¢
class Circle implements Shape {
    @Override
    public void draw() {
        System.out.println("Drawing a circle.");
    }
}

// å…·ä½“çš„å®ç°ç±» - çŸ©å½¢
class Rectangle implements Shape {
    @Override
    public void draw() {
        System.out.println("Drawing a rectangle.");
    }
}

// ç©ºå¯¹è±¡ç±»
class NullShape implements Shape {
    @Override
    public void draw() {
        // ç©ºå¯¹è±¡çš„é»˜è®¤è¡Œä¸ºæ˜¯ä»€ä¹ˆï¼Œè¿™é‡Œå¯ä»¥æ ¹æ®å®é™…éœ€æ±‚å®šä¹‰
        System.out.println("No shape to draw.");
    }
}

```

```java
// å½¢çŠ¶å·¥å‚ç±»
class ShapeFactory {
    // è·å–å½¢çŠ¶å¯¹è±¡
    @NonNull
    public static Shape getShape(String shapeType) {
        if (shapeType == null) {
            return new NullShape(); // è¿”å›ç©ºå¯¹è±¡
        } else if (shapeType.equalsIgnoreCase("Circle")) {
            return new Circle(); // è¿”å›åœ†å½¢å¯¹è±¡
        } else if (shapeType.equalsIgnoreCase("Rectangle")) {
            return new Rectangle(); // è¿”å›çŸ©å½¢å¯¹è±¡
        } else {
            return new NullShape(); // è¿”å›ç©ºå¯¹è±¡
        }
    }
}
```

2. è¿”å›æœ‰æ•ˆé»˜è®¤å€¼ï¼Œè€Œä¸æ˜¯null
```java
public List<Cats> getCats() {
    List<Cats> cats = zoo.getCats();
    return cats != null ? cats : Collections.emptyList();
}

private final static Cats[] EMPTY_CAT_ARRAY = new Cats[0];

public Cats[] getCats() {
    Cats[] cats = zoo.getCats();
    return cats != null ? cats : EMPTY_CAT_ARRAY;
}

public String getCatName(int catId) {
    String name = db.getNameById(catId);
    return name != null ? name : "";
}
```
3. åŒæ ·ï¼Œå¯ä»¥ä½¿ç”¨åº“`androidx.annotation`çš„æ³¨è§£ `@IntDef`ã€`@StringDef` æˆ– `@IntRange`ã€`@FloatRange`ã€`@Size`é™å®šè¿”å›å€¼èŒƒå›´

4. ä½¿ç”¨åº“ `androidx.annotation` çš„`@RequiresPermission`æ³¨è§£é™åˆ¶æƒé™ï¼Œè¿”å›å€¼å—æƒé™æˆäºˆçš„å½±å“ï¼ˆæ¯”å¦‚æ–¹æ³•ä¸­æœ‰è®¿é—®æ–‡ä»¶æ—¶ï¼Œæ³¨æ„æƒé™ï¼‰
```java
@RequiresPermission(Manifest.permission.KILL_BACKGROUND_PROCESSES)
public static Set<String> getAllBackgroundProcesses() {
    ActivityManager am = (ActivityManager) Utils.getApp().getSystemService(Context.ACTIVITY_SERVICE);
    List<ActivityManager.RunningAppProcessInfo> info = am.getRunningAppProcesses();
    Set<String> set = new HashSet<>();
    if (info != null) {
        for (ActivityManager.RunningAppProcessInfo aInfo : info) {
            Collections.addAll(set, aInfo.pkgList);
        }
    }
    return set;
}
```
6. ä½¿ç”¨åº“ `androidx.annotation` çš„ `@WorkerThread` ã€ `@UIThread` ã€ `@MainThread` æˆ– `@AnyThread` æ³¨è§£é™åˆ¶çº¿ç¨‹
 ```java
@WorkerThread
@NonNull
public static List<Resource> getUserAllResources(File jsonFile) {
    String str = FileUtil.readSdCardJsonFile(jsonFile.getAbsolutePath());
    return getUserAllResources(str);
}
```
æˆ–è€…ä½¿ç”¨ kotlin `suspend` é™åˆ¶çº¿ç¨‹
````kotlin
suspend fun uploadFile(path: String):String{
   return withContext(Dispatchers.IO) {
   }
}
````

### å¼‚å¸¸

é¦–å…ˆï¼Œç†Ÿæ‚‰ä¸€ä¸‹ Java è¯­è¨€å¼‚å¸¸ã€‚

Java è¯­è¨€ï¼Œå¼‚å¸¸åˆ†ä¸ºException å’Œ Errorï¼ŒException å’Œ Error ç±»éƒ½ç»§æ‰¿è‡ª `Throwable` ç±»ã€‚

* **Exceptionï¼ˆç¨‹åºå¯æ¢å¤ï¼‰**ï¼šè¡¨ç¤ºç¨‹åºå¯ä»¥å¤„ç†çš„å¼‚å¸¸ï¼Œå¯ä»¥æ•è·å¹¶ä¸”å¯æ¢å¤ã€‚é‡åˆ°è¿™ç±»å¼‚å¸¸ï¼Œåº”è¯¥å°½å¯èƒ½å¤„ç†å¼‚å¸¸ï¼Œä½¿ç¨‹åºæ¢å¤è¿è¡Œï¼Œè€Œä¸åº”è¯¥éšæ„ç»ˆæ­¢å¼‚å¸¸ã€‚

* **Errorï¼ˆç¨‹åºä¸å¯æ¢å¤ï¼‰**ï¼šä¸€èˆ¬æŒ‡è™šæ‹Ÿæœºç›¸å…³çš„é—®é¢˜ï¼Œå¦‚ç³»ç»Ÿå´©æºƒï¼Œè™šæ‹Ÿæœºé”™è¯¯ï¼Œå†…å­˜ç©ºé—´ä¸è¶³ï¼Œæ–¹æ³•è°ƒç”¨æ ˆæº¢å‡ºç­‰ã€‚è¿™äºè¿™ç±»é”™è¯¯ï¼ŒJavaç¼–è¯‘å™¨ä¸å»æ£€æŸ¥ä¹Ÿä¼šå¯¼è‡´åº”ç”¨ç¨‹åºä¸­æ–­ï¼Œä»…é ç¨‹åºæœ¬èº«æ— æ³•æ¢å¤å’Œé¢„é˜²ï¼Œé‡åˆ°è¿™æ ·çš„é”™è¯¯ï¼Œå»ºè®®ç¨‹åºç»ˆæ­¢ã€‚

Exception åˆåˆ†ä¸ºè¿è¡Œæ—¶å¼‚å¸¸å’Œå—æ£€æŸ¥çš„å¼‚å¸¸ï¼š

* **è¿è¡Œæ—¶å¼‚å¸¸**ï¼šå¦‚ç©ºæŒ‡é’ˆï¼Œå‚æ•°é”™è¯¯ç­‰ã€‚
* **å—æ£€æŸ¥å¼‚å¸¸**ï¼šè¿™ç±»å¼‚å¸¸å¦‚æœæ²¡æœ‰try/catchè¯­å¥ä¹Ÿæ²¡æœ‰throwsæŠ›å‡ºï¼Œç¼–è¯‘ä¸é€šè¿‡ã€‚

ç¼–å†™ä¸€ä¸ªæ–¹æ³•çš„æ—¶å€™ï¼Œä¸»è¦æ˜¯å¤„ç†è¿è¡Œæ—¶å¼‚å¸¸å’Œå—æ£€å¼‚å¸¸ã€‚

å¯¹äºå¤„ç†å¼‚å¸¸çš„å‡†åˆ™å¤§æ¦‚æœ‰ï¼š
* ç²¾ç¡®æ•è·å¼‚å¸¸ï¼šåªæ•è·èƒ½å¤Ÿå¤„ç†çš„å¼‚å¸¸ç±»å‹ï¼Œé¿å…æ•è·è¿‡äºå®½æ³›çš„å¼‚å¸¸ï¼Œè¿™æ ·æ‰èƒ½æ›´ç²¾å‡†åœ°å®šä½å’Œå¤„ç†é—®é¢˜ã€‚
* é€‚å½“å¤„ç†å¼‚å¸¸ï¼šæ ¹æ®å…·ä½“æƒ…å†µé€‚å½“åœ°å¤„ç†å¼‚å¸¸ï¼Œå¯ä»¥æ˜¯é€šè¿‡ä¿®å¤é—®é¢˜ã€æä¾›é»˜è®¤å€¼ã€å‘ä¸Šå±‚æŠ›å‡ºå¼‚å¸¸æˆ–è®°å½•æ—¥å¿—ç­‰æ–¹å¼ã€‚
* ä¸è¦å¿½ç•¥å¼‚å¸¸ï¼šä¸è¦åœ¨ catch å—ä¸­ä¸åŠ æ€è€ƒåœ°ç©ºå®ç°æˆ–æ‰“å°ç©ºæ—¥å¿—ï¼Œè¿™æ ·ä¼šéšè—é—®é¢˜å¹¶ä½¿å…¶æ›´éš¾ä»¥è°ƒè¯•å’Œè§£å†³ã€‚
* å¼‚å¸¸å¤„ç†ä¸ä¸šåŠ¡é€»è¾‘åˆ†ç¦»ï¼šå°†å¼‚å¸¸å¤„ç†ä¸ä¸šåŠ¡é€»è¾‘åˆ†ç¦»ï¼Œé¿å…åœ¨ä¸šåŠ¡é€»è¾‘ä¸­ç›´æ¥å¤„ç†å¼‚å¸¸ï¼Œè¿™æ ·å¯ä»¥ä½¿ä»£ç æ›´æ¸…æ™°ã€å¯è¯»æ€§æ›´é«˜ã€‚
* ç»Ÿä¸€å¼‚å¸¸å¤„ç†ï¼šåœ¨åˆé€‚çš„åœ°æ–¹è¿›è¡Œç»Ÿä¸€çš„å¼‚å¸¸å¤„ç†ï¼Œä¾‹å¦‚åœ¨é¡¶å±‚ç»Ÿä¸€å¤„ç†æœªæ•è·çš„å¼‚å¸¸ï¼Œå¹¶å°†å¼‚å¸¸ä¿¡æ¯è®°å½•ä¸‹æ¥ï¼Œä»¥ä¾¿åç»­åˆ†æå’Œå¤„ç†ã€‚
* è‰¯å¥½çš„å¼‚å¸¸ä¿¡æ¯ï¼šåœ¨æ•è·å¼‚å¸¸æ—¶æä¾›æ¸…æ™°ã€å…·ä½“çš„å¼‚å¸¸ä¿¡æ¯ï¼ŒåŒ…æ‹¬å¼‚å¸¸ç±»å‹ã€å‘ç”Ÿä½ç½®ã€å¼‚å¸¸åŸå› ç­‰ï¼Œä¾¿äºåç»­æ’æŸ¥é—®é¢˜ã€‚
* å¼‚å¸¸çš„æŠ›å‡ºå’Œä¼ é€’ï¼šåœ¨é€‚å½“çš„æ—¶å€™æŠ›å‡ºå¼‚å¸¸å¹¶å°†å¼‚å¸¸ä¼ é€’ç»™è°ƒç”¨è€…ï¼Œè®©è°ƒç”¨è€…å†³å®šå¦‚ä½•å¤„ç†å¼‚å¸¸ï¼Œé¿å…åœ¨æ–¹æ³•å†…éƒ¨è¿‡åº¦å¤„ç†å¼‚å¸¸ã€‚


1. è°ƒç”¨ä»–äººæä¾›çš„æ–¹æ³•æˆ–ä¸ä¿¡ä»»çš„æ–¹æ³•ï¼Œæœ€å¥½try-catch

ä»–äººæä¾›çš„æ–¹æ³•ï¼Œå¦‚æœæ²¡æœ‰ä»”ç»†é˜…è¯»å…¶æºç ï¼Œé‚£ä¹ˆå°±å¾—å°å¿ƒä½¿ç”¨ï¼Œå¦åˆ™å¯èƒ½è§¦å‘éšè—çš„ç‚¸å¼¹ï¼Œå¦‚ä¸‹é¢é€šç”¨å·¥å…·ç±» `FileUtils.java` æä¾›çš„æ–¹æ³• `long sizeOf(File file)`ï¼š
```java
public static long sizeOf(@NonNull File file) {
    if (!file.exists()) {
        String message = file + " does not exist";
        throw new IllegalArgumentException(message);
    }
    if (file.isDirectory()) {
        return sizeOfDirectory(file);
    } else {
        return file.length();
    }
}
```
ç„¶ååœ¨è‡ªå·±çš„æ–¹æ³•ä¸­ç›´æ¥ä½¿ç”¨ï¼š

```java
public void uploadVideo(@NonNull String filePath){
    long fileSize = FileUtils.sizeOf(new File(filePath));
}
```
è¿™åœ¨çº¿ä¸Šè¿è¡Œï¼Œåªèƒ½ç¥ˆæ±‚ä¸è¦è§¦å‘è¿™ä¸ªç‚¸å¼¹ï¼Œæ‰€ä»¥**ä½¿ç”¨ä»–äººæä¾›çš„æ–¹æ³•å‰ï¼Œæœ€å¥½é˜…è¯»ä¸€ä¸‹æºç æˆ–æŸ¥çœ‹ä»–äººæ˜¯æ€ä¹ˆä½¿ç”¨çš„ï¼Œç„¶åçœ‹æ˜¯å¦æœ‰å¿…è¦try-catch ä¸€ä¸‹**ï¼š
```java
public void uploadVideo(@NonNull String filePath){
    try {
        long fileSize = FileUtils.sizeOf(new File(filePath));
    } catch (IllegalArgumentException e) {
        Log.e(TAG, e.getMessage(), e);
    }
}
```

2. è¾“å‡ºå¹¶ä¸ŠæŠ¥æ•è·åˆ°çš„å¼‚å¸¸ä¿¡æ¯

ç¡®ä¿å¼‚å¸¸ä¿¡æ¯èƒ½è¢« app æ—¥å¿—åº“æ”¶é›†åˆ°ï¼Œæˆ–åœ¨æ¡ä»¶å…è®¸ä¸‹ï¼Œä¸»åŠ¨å°†å¼‚å¸¸ä¿¡æ¯ä¸ŠæŠ¥åˆ°å…¬å¸çš„ apm å¹³å°ã€‚

**è¦ä¸»åŠ¨è·å–å¼‚å¸¸ä¿¡æ¯ï¼Œä¸è¦è¢«åŠ¨è·å–å¼‚å¸¸ä¿¡æ¯ï¼Œè¢«åŠ¨æ—¶å¯èƒ½ä¸ºæ—¶å·²æ™š**ã€‚
```java
public void uploadVideo(@NonNull String filePath){
    try {
        long fileSize = FileUtils.sizeOf(new File(filePath));
    } catch (IllegalArgumentException e) {
        //app æ—¥å¿—åº“æ”¶é›†æ—¥å¿—
        MyLog.e(TAG, e.getMessage(), e);
        //ä¸»åŠ¨ä¸ŠæŠ¥å¼‚å¸¸ä¿¡æ¯åˆ° apm å¹³å°
        CrashReporter.postCaughtException(new Exception("Upload Video Failed.",e));
    }
}
```
3. å¤„ç†å¼‚å¸¸ï¼Œå£°æ˜å¼‚å¸¸ï¼Œç»Ÿä¸€å¼‚å¸¸

å¤„ç†å¼‚å¸¸æ—¶ï¼Œå¤„ç†å…·ä½“å¼‚å¸¸ï¼Œå¹¶è¯¦ç»†æè¿°ç›¸å…³å¼‚å¸¸ä¿¡æ¯ï¼Œæœ‰å¤šä¸ªå¼‚å¸¸æ—¶ï¼Œå¯ä»¥ç»Ÿä¸€å¤„ç†å¼‚å¸¸ï¼Œå¦‚å‚çœ‹ç³»ç»Ÿæ–¹æ³•
`FragmentFactory#instantiate` çš„å¼‚å¸¸å¤„ç†ï¼š
```java
/**
 * Create a new instance of a Fragment with the given class name. This uses
 * {@link #loadFragmentClass(ClassLoader, String)} and the empty
 * constructor of the resulting Class by default.
 *
 * @param classLoader The default classloader to use for instantiation
 * @param className The class name of the fragment to instantiate.
 * @return Returns a new fragment instance.
 * @throws Fragment.InstantiationException If there is a failure in instantiating
 * the given fragment class.  This is a runtime exception; it is not
 * normally expected to happen.
 */
@NonNull
public Fragment instantiate(@NonNull ClassLoader classLoader, @NonNull String className) {
    try {
        Class<? extends Fragment> cls = loadFragmentClass(classLoader, className);
        return cls.getConstructor().newInstance();
    } catch (java.lang.InstantiationException e) {
        throw new Fragment.InstantiationException("Unable to instantiate fragment " + className
                + ": make sure class name exists, is public, and has an"
                + " empty constructor that is public", e);
    } catch (IllegalAccessException e) {
        throw new Fragment.InstantiationException("Unable to instantiate fragment " + className
                + ": make sure class name exists, is public, and has an"
                + " empty constructor that is public", e);
    } catch (NoSuchMethodException e) {
        throw new Fragment.InstantiationException("Unable to instantiate fragment " + className
                + ": could not find Fragment constructor", e);
    } catch (InvocationTargetException e) {
        throw new Fragment.InstantiationException("Unable to instantiate fragment " + className
                + ": calling Fragment constructor caused an exception", e);
    }
}
```
4. å¤„ç†ä¸äº†æˆ–å¯ä¸å¤„ç†çš„å¼‚å¸¸å‘å¤–æŠ›
```java
/**
 * ä»æ–‡ä»¶ä¸­è¯»å–å­—ç¬¦ä¸²å†…å®¹
 * @param path æ–‡ä»¶åœ°å€
 *
 * @return è¯»å–å¤±è´¥æ—¶è¿”å›ç©ºå­—ç¬¦ä¸²
 */
public static String fileToString(String path) throws IOException {
    return FileUtils.readFileToString(new File(path), "UTF-8");
}
/**
 * å°†å­—ç¬¦ä¸²å†™å…¥æ–‡ä»¶
 *
 * @param filename æ–‡ä»¶åç§°
 * @param string å­—ç¬¦ä¸²å†…å®¹
 */
public static void stringToFile(String filename, String string) throws IOException {
    FileWriter out = new FileWriter(filename);
    try {
        out.write(string);
    } finally {
        out.close();
    }
}
```
5. åœ¨å¼€å‘é˜¶æ®µå°½é‡æš´éœ²å¼‚å¸¸ï¼Œè®©ç¨‹åºå´©æºƒï¼Œæ’æŸ¥å‡ºå¼‚å¸¸å…·ä½“åŸå› ï¼Œç„¶åä¿®æ”¹ä»£ç ï¼Œè®©ä»£ç æ›´å¥å£®
```java
public static String fileToString(String path){
    try {
        return FileUtils.readFileToString(new File(path), "UTF-8");
    } catch (IOException e) {
        //é‡åˆ°å¼‚å¸¸ï¼Œåœ¨å¼€å‘é˜¶æ®µè®©ç¨‹åºå´©æºƒï¼Œä»¥æ¶ˆé™¤é—®é¢˜case
        throw new RuntimeException(e);
    }
}
```
### æ—¥å¿—

åœ¨ç¼–å†™çš„ä»£ç ä¸­ï¼Œå¯ä»¥åˆ†é˜¶æ®µï¼šå¼€å‘é˜¶æ®µã€æµ‹è¯•é˜¶æ®µã€çº¿ä¸Šé˜¶æ®µæ·»åŠ ä¸€äº›å…³é”®æ—¥å¿—ã€‚æ·»åŠ æ—¥å¿—çš„ç›®çš„æ˜¯ï¼šäº†è§£ç¨‹åºè¿è¡Œæ—¶çš„çŠ¶æ€å’Œè¡Œä¸ºï¼Œä»è€Œè¯Šæ–­å’Œè°ƒè¯•é—®é¢˜ï¼Œç„¶ååšå‡ºä¿®æ­£å’Œæ”¹è¿›ä»¥ä¿è¯å…¶æ­£ç¡®æ€§ã€‚

æ·»åŠ æ—¥å¿—çš„ä¸»è¦ä½œç”¨æ˜¯ï¼šæ•…éšœæ’æŸ¥ã€æ€§èƒ½åˆ†æã€è¡Œä¸ºè·Ÿè¸ªã€‚

* æ•…éšœæ’æŸ¥ï¼šåœ¨ç¨‹åºå‡ºç°é”™è¯¯æˆ–å¼‚å¸¸æ—¶å¿«é€Ÿå®šä½é—®é¢˜
* æ€§èƒ½åˆ†æï¼šé€šè¿‡è®°å½•ç¨‹åºçš„è¿è¡Œæ—¶é—´ã€èµ„æºæ¶ˆè€—ç­‰ä¿¡æ¯è¿›è¡Œæ€§èƒ½åˆ†æï¼Œæˆ–å‘ç°ç¨‹åºä¸­çš„æ€§èƒ½ç“¶é¢ˆ
* è¡Œä¸ºè·Ÿè¸ªï¼šäº†è§£ç¨‹åºçš„è¡Œä¸ºå’Œæ‰§è¡Œæµç¨‹ï¼Œæ–¹ä¾¿é—®é¢˜æ’æŸ¥å’Œå¤ç°


åœ¨æ·»åŠ æ—¥å¿—æ—¶ï¼Œä¸€èˆ¬éœ€è¦è®°å½•çš„ä¿¡æ¯æœ‰ï¼š

* é”™è¯¯å’Œå¼‚å¸¸ä¿¡æ¯ï¼šè®°å½•ç¨‹åºå‡ºç°çš„é”™è¯¯å’Œå¼‚å¸¸ä¿¡æ¯ï¼ŒåŒ…æ‹¬å¼‚å¸¸ç±»å‹ã€å †æ ˆä¿¡æ¯ç­‰
* å…³é”®æ“ä½œå’ŒçŠ¶æ€å˜åŒ–ï¼šè®°å½•å…³é”®æ“ä½œçš„æ‰§è¡Œæƒ…å†µå’ŒçŠ¶æ€å˜åŒ–ï¼Œä¾‹å¦‚æ•°æ®åº“æ“ä½œã€ç½‘ç»œè¯·æ±‚ã€ç”¨æˆ·äº¤äº’ç­‰
* æ€§èƒ½æŒ‡æ ‡ï¼šè®°å½•ç¨‹åºçš„æ€§èƒ½æŒ‡æ ‡ï¼Œä¾‹å¦‚è¿è¡Œæ—¶é—´ã€å†…å­˜å ç”¨ã€CPUåˆ©ç”¨ç‡ç­‰
* è°ƒè¯•ä¿¡æ¯ï¼šè®°å½•è°ƒè¯•ä¿¡æ¯ï¼ŒåŒ…æ‹¬å˜é‡å€¼ã€æ–¹æ³•è°ƒç”¨æ ˆã€æ¡ä»¶åˆ†æ”¯æ‰§è¡Œæƒ…å†µç­‰

æ³¨æ„ï¼šåœ¨æ·»åŠ æ—¥å¿—æ—¶ï¼Œæ ¹æ®å…·ä½“æƒ…å†µé€‰æ‹©åˆé€‚çš„æ—¥å¿—çº§åˆ«å’Œæ ¼å¼ï¼Œé¿å…è¿‡å¤šæˆ–è¿‡å°‘åœ°è®°å½•æ—¥å¿—ä¿¡æ¯ï¼Œä»¥ç¡®ä¿æ—¥å¿—çš„æœ‰æ•ˆæ€§å’Œå®ç”¨æ€§ã€‚åŒæ—¶ï¼Œæ³¨æ„ä¿æŠ¤ç”¨æˆ·éšç§å’Œæ•æ„Ÿä¿¡æ¯ï¼Œé¿å…å°†æ•æ„Ÿä¿¡æ¯è®°å½•åœ¨æ—¥å¿—ä¸­ã€‚

#### å¼€å‘æ—¥å¿—

å¼€å‘é˜¶æ®µçš„æ—¥å¿—ä¸»è¦æ˜¯æ•…éšœæ’æŸ¥ï¼Œæ‰€ä»¥å°½é‡è¯¦ç»†ä¸€ç‚¹ï¼Œå¹¶è®©æ—¥å¿—çº§åˆ«å‡é«˜ã€‚ä½†åœ¨ä¸Šçº¿ä¹‹å‰ï¼Œå°½é‡æ¸…é™¤å¼€å‘æ—¥å¿—ï¼Œæœ€å¤šä¿ç•™ error çº§åˆ«æ—¥å¿—ã€‚

æ¯”å¦‚æ–°å†™ä¸€ä¸ªæ–¹æ³•ï¼šä¿å­˜ bitmap åˆ°æ–‡ä»¶ï¼Œå¼€å‘å…³å¿ƒ bitmap æ˜¯å¦å›æ”¶ï¼Œå­˜å‚¨æ–‡ä»¶å¤¹æ˜¯å¦å­˜åœ¨ï¼Œå­˜å‚¨é‡åˆ°å¼‚å¸¸ç­‰
```java
public static boolean saveBitmap(@NonNull Bitmap bitmap, @NonNull String dir, @NonNull String name, @IntRange(from = 0, to = 100) int quality) {
    if (bitmap.isRecycled()) {
        MyLog.e(TAG, "bitmap is recycled");
        return false;
    }
    if (TextUtils.isEmpty(dir)) {
        MyLog.e(TAG, "dir is empty");
        return false;
    }
    if (TextUtils.isEmpty(name)) {
        MyLog.e(TAG, "name is empty");
        return false;
    }
    File dirFile = new File(dir);
    if (!dirFile.exists()) {
        boolean ret = dirFile.mkdirs();
        if (!ret) {
            MyLog.e(TAG, "create dir failed. dir=" + dir);
            return false;
        }
    }
    File file = new File(dirFile, name);
    OutputStream outputStream = null;
    try {
        boolean ret = file.createNewFile();
        if (!ret) {
            return false;
        }
        outputStream = new FileOutputStream(file);
        return bitmap.compress(Bitmap.CompressFormat.PNG, quality, outputStream);
    } catch (FileNotFoundException e) {
        MyLog.e(TAG, "FileNotFound:" + file.getAbsolutePath(), e);
    } catch (IOException e) {
        MyLog.e(TAG, e.getMessage(), e);
    } finally {
        if (outputStream != null) {
            try {
                outputStream.close();
            } catch (IOException e) {
                MyLog.e(TAG, "close stream failed");
            }
        }
    }
    return false;
}
```


#### æµ‹è¯•æ—¥å¿—
æµ‹è¯•é˜¶æ®µçš„æ—¥å¿—ä¸»è¦æ˜¯æµ‹è¯•äººå‘˜å…³æ³¨çš„æ—¥å¿—ä¿¡æ¯ï¼Œé™¤äº†æ•…éšœæ’æŸ¥ï¼Œæ€§èƒ½åˆ†æå’Œè¡Œä¸ºè¿½è¸ªç›¸å…³æ—¥å¿—å¤–ï¼Œå¯èƒ½è¿˜æœ‰ä¸€äº›ä¸šåŠ¡ä¸Šä¸‹æ–‡ï¼Œæˆ–é¡¹ç›®ç¯å¢ƒç›¸å…³æ—¥å¿—ã€‚ä½†åœ¨ä¸Šçº¿ä¹‹å‰ï¼Œå°½é‡æ¸…é™¤æµ‹è¯•æ—¥å¿—ã€‚

æ¯”å¦‚æ–‡ä»¶ä¸‹è½½ï¼Œæµ‹è¯•äººå‘˜å…³æ³¨ä¸‹è½½æ‰€æœ‰çŠ¶æ€ï¼Œä¸‹è½½å¼€å§‹ï¼Œä¸‹è½½è¿›åº¦ï¼Œä¸‹è½½é€Ÿåº¦ï¼Œä¸‹è½½æš‚åœï¼Œä¸‹è½½é‡è¯•ï¼Œä¸‹è½½æˆåŠŸï¼Œä¸‹è½½å¤±è´¥ï¼Œä¸‹è½½å–æ¶ˆã€‚
```kotlin
private val downloadListener = object : DownloadListener {
    override fun onStart(taskId: String) {
        super.onStart(taskId)
        MyLog.e(TAG,"onStart:taskId=$taskId")
    }

    override fun onLoading(taskId: String, speed: Long, totalSize: Long, loadedSize: Long, progress: Int) {
        super.onLoading(taskId, speed, totalSize, loadedSize, progress)
        MyLog.e(TAG,"onLoading:taskId=$taskId, speed=$speed, totalSize=$totalSize, loadedSize=$loadedSize, progress=$progress")
    }

    override fun onPause(taskId: String, totalSize: Long, loadedSize: Long) {
        super.onPause(taskId, totalSize, loadedSize)
        MyLog.e(TAG,"onPause:taskId=$taskId, totalSize=$totalSize, loadedSize=$loadedSize")
    }

    override fun onRetry(taskId: String, retryTimes: Int) {
        super.onRetry(taskId, retryTimes)
        MyLog.e(TAG,"onRetry:taskId=$taskId, retryTimes=$retryTimes")
    }

    override fun onFinish(taskId: String, dir: String?, name: String?) {
        super.onFinish(taskId, dir, name)
        MyLog.e(TAG,"onFinish:taskId=$taskId, dir=$dir, name=$name")
    }

    override fun onError(taskId: String, errorCodes: List<Int>?, totalSize: Long, loadedSize: Long) {
        super.onError(taskId, errorCodes, totalSize, loadedSize)
        MyLog.e(TAG,"onError:taskId=$taskId, errorCodes=$errorCodes, totalSize=$totalSize, loadedSize=$loadedSize")
    }

    override fun onCancel(taskId: String) {
        super.onCancel(taskId)
        MyLog.e(TAG,"onCancel:taskId=$taskId")
    }
}
```
#### çº¿ä¸Šæ—¥å¿—
çº¿ä¸Šé˜¶æ®µçš„æ—¥å¿—ä¸»è¦æ˜¯æ’æŸ¥é—®é¢˜ï¼Œè¦ç®€çŸ­å…³é”®ã€‚

æ¯”å¦‚ä¸šåŠ¡ä»£ç ï¼Œä»æ–‡ä»¶ä¸­è¯»å–jsonå­—ç¬¦ä¸²å¹¶è½¬æ¢ä¸ºå¯¹è±¡ï¼Œå¦‚æœè·å–åˆ°çš„å¯¹è±¡ä¸ºç©ºï¼Œè¦å¿«é€Ÿæ’æŸ¥é—®é¢˜æ‰€åœ¨ï¼Œæ˜¯å­—ç¬¦ä¸²ç¼–ç é—®é¢˜ï¼Œè¿˜æ˜¯ json æ•°æ®é—®é¢˜ç­‰ã€‚
```java
@WorkerThread
@Nullable
private Cat getCat(@NonNull String jsonPath){
    if (TextUtils.isEmpty(jsonPath)) {
        return null;
    }
    File jsonFile = new File(jsonPath);
    try {
        String json = readFileToString(jsonFile, "UTF-8");
        return JSON.parseObject(json, Cat.class);
    } catch (IOException e) {
        MyLog.e(TAG, "read file failed: jsonPath=" + jsonPath + ", fileSize=" + jsonFile.length(), e);
        return null;
    } catch (JSONException e) {
        MyLog.e(TAG, "parse json failed: " + json, e);
        return null;
    }
}

/**
 * è¯»å–æ–‡ä»¶å†…å®¹è½¬æ¢ä¸ºå­—ç¬¦ä¸²
 *
 * @param file     æ–‡ä»¶
 * @param encoding ç¼–ç æ–¹å¼
 * @return æ–‡ä»¶å†…å®¹å­—ç¬¦ä¸²
 * @throws IOException                  I/Oå¼‚å¸¸
 * @throws UnsupportedEncodingException å­—ç¬¦ä¸²ç¼–ç å¼‚å¸¸
 */
@NonNull
public static String readFileToString(@NonNull File file, @Nullable String encoding) throws IOException {
    Charset charset = null;
    try {
        charset = encoding == null ? Charset.defaultCharset() : Charset.forName(encoding);
    } catch (Exception e) {
        throw new UnsupportedEncodingException("Unsupported encoding " + encoding);
    }
    byte[] buff = readFileToByteArray(file);
    return new String(buff, charset);
}
```

### æµ‹è¯•ä¿éšœ
å½“å®Œæˆä¸€ä¸ª featureï¼Œä¸€èˆ¬æµç¨‹æ˜¯å¼€å‘äººå‘˜ä½¿ç”¨æµ‹è¯•ç”¨ä¾‹è¿›è¡Œè‡ªæˆ‘æµ‹è¯•ï¼Œç„¶åæµ‹è¯•äººå‘˜è¿›è¡Œå†’çƒŸæµ‹è¯•ã€å…¨é‡æµ‹è¯•ã€é›†æˆæµ‹è¯•ã€éªŒæ”¶æµ‹è¯•ç­‰éªŒè¯ï¼Œæœ€åä¸Šçº¿ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œfeature è´¨é‡æˆ–è€…è¯´ä»£ç è´¨é‡çš„ä¿éšœï¼Œä¸åº”è¯¥å®Œå…¨äº¤ç»™æµ‹è¯•äººå‘˜æ¥ä¿éšœã€‚ä½œä¸ºå¼€å‘äººå‘˜ï¼Œåªæœ‰è‡ªå·±å¯¹ä»£ç æœ€ç†Ÿæ‚‰ï¼Œæ‰€ä»¥å®Œæˆ feature åï¼Œå¯ä»¥è‡ªæˆ‘è¿›è¡Œä¸€äº›è´¨é‡ä¿éšœæ£€æŸ¥ã€‚

#### å•å…ƒæµ‹è¯•

å•å…ƒæµ‹è¯•ç†è®ºä¸Šçš„ä½œç”¨æ˜¯éªŒè¯ä»£ç çš„æ­£ç¡®æ€§å’Œå¯é æ€§ï¼Œå‘ç°æ½œåœ¨çš„ bug å’Œé”™è¯¯ï¼Œä»¥æé«˜ä»£ç çš„è´¨é‡ã€‚ä½†ç›®å‰é¡¹ç›®å¼€å‘å®é™…æƒ…å†µæ˜¯ï¼šè¦ä¹ˆæ²¡æœ‰å•å…ƒæµ‹è¯•ï¼Œè¦ä¹ˆå•å…ƒæµ‹è¯•å†™äº†å°±æ‰”äº†ï¼Œè¿™å¯èƒ½ä¸æˆ‘ä»¬çš„é¡¹ç›®ç¯å¢ƒï¼Œäº§å“è¿­ä»£å‘¨æœŸï¼ŒæŠ€æœ¯æ°›å›´æœ‰å…³ç³»ã€‚ä¸è¿‡ï¼Œå¯¹äºä¸ªäººæ¥è¯´ï¼Œå†™å•å…ƒæµ‹è¯•æ€»æ˜¯å¥½çš„ï¼Œç‰¹åˆ«æ˜¯åœ¨åšæŠ€æœ¯éœ€æ±‚ï¼Œæ¯”å¦‚å¼€å‘ä¸Šä¼ ç»„ä»¶ã€ä¸‹è½½ç»„ä»¶ç­‰åŸºç¡€é€šç”¨ç»„ä»¶ï¼Œæˆ–è€…åšæ ¸å¿ƒä»£ç æ›´æ”¹å’Œé‡æ„æ—¶ï¼Œèƒ½å¸®åŠ©è‡ªå·±æ›´äº†è§£éœ€æ±‚ï¼Œæ›´äº†è§£æ–¹æ³•è¾“å…¥è¾“å‡ºï¼Œæ›´äº†è§£æ¨¡å—åŠŸèƒ½ä½¿ç”¨åœºæ™¯ï¼Œè¿›è€Œä¸æ–­çš„æ„æ€å’Œä¿®æ”¹é€»è¾‘ï¼Œè®©é€»è¾‘åœ¨ä»£ç ä¸­å’Œè‡ªå·±è„‘è¢‹ä¸­éƒ½è¶Šæ¥è¶Šæ¸…æ™°ã€‚

AndroidStudioå¯¹ Android é¡¹ç›®çš„æä¾›äº† [æœ¬åœ°å•å…ƒæµ‹è¯•å’Œæ’æ¡©æµ‹è¯•](https://developer.android.com/studio/test/test-in-android-studio?hl=zh-cn)ã€‚

è¿™é‡Œä¸ä»‹ç»å¦‚ä½•å»åšæœ¬åœ°å•å…ƒæµ‹è¯•å’Œæ’æ¡©æµ‹è¯•ã€‚

å•å…ƒæµ‹è¯•éœ€è¦æµ‹è¯•ç­–ç•¥ï¼šè‰¯å¥½çš„æµ‹è¯•ç­–ç•¥åº”å›´ç»•ä»£ç çš„ä¸åŒè·¯å¾„å’Œè¾¹ç•Œã€‚åœ¨æœ€åŸºæœ¬çš„å±‚é¢ä¸Šï¼Œå¯ä»¥å°†æµ‹è¯•åˆ†ç±»ä¸ºä¸‰ç§åœºæ™¯ï¼š**æˆåŠŸè·¯å¾„ã€é”™è¯¯è·¯å¾„å’Œè¾¹ç•Œæƒ…å†µ**ã€‚
> -   æˆåŠŸè·¯å¾„ï¼šæˆåŠŸè·¯å¾„æµ‹è¯•ï¼ˆä¹Ÿç§°ä¸ºç†æƒ³è·¯å¾„æµ‹è¯•ï¼‰ä¾§é‡äºæµ‹è¯•æ­£å‘æµçš„åŠŸèƒ½ã€‚æ­£å‘æµæ˜¯æŒ‡ä¸å­˜åœ¨ä»»ä½•å¼‚å¸¸æˆ–é”™è¯¯æƒ…å†µçš„æµã€‚ä¸é”™è¯¯è·¯å¾„å’Œè¾¹ç•Œæƒ…å†µåœºæ™¯ç›¸æ¯”ï¼Œåˆ›å»ºæˆåŠŸè·¯å¾„åœºæ™¯çš„è¯¦å°½åˆ—è¡¨æ˜¯å¾ˆå®¹æ˜“çš„ï¼Œå› ä¸ºå®ƒä»¬å…³æ³¨çš„æ˜¯åº”ç”¨çš„é¢„æœŸè¡Œä¸ºã€‚
> 
> -   é”™è¯¯è·¯å¾„ï¼šé”™è¯¯è·¯å¾„æµ‹è¯•ä¾§é‡äºæµ‹è¯•è´Ÿå‘æµçš„åŠŸèƒ½ï¼Œå³æ£€æŸ¥åº”ç”¨å¦‚ä½•å“åº”é”™è¯¯æƒ…å†µæˆ–æ— æ•ˆç”¨æˆ·è¾“å…¥ã€‚ç¡®å®šæ‰€æœ‰å¯èƒ½çš„é”™è¯¯æµæ˜¯ä¸€é¡¹æå…·æŒ‘æˆ˜æ€§çš„ä»»åŠ¡ï¼Œå› ä¸ºå¦‚æœæœªå®ç°é¢„æœŸè¡Œä¸ºï¼Œåˆ™ä¼šæœ‰è®¸å¤šå¯èƒ½çš„ç»“æœã€‚ï¼ˆä¸€é¡¹ä¸€èˆ¬æ€§å»ºè®®æ˜¯åˆ—å‡ºæ‰€æœ‰å¯èƒ½çš„é”™è¯¯è·¯å¾„ï¼Œé’ˆå¯¹è¿™äº›é”™è¯¯ç¼–å†™æµ‹è¯•ï¼Œå¹¶éšç€æ‚¨å‘ç°ä¸åŒçš„åœºæ™¯è€Œä¸æ–­æ”¹è¿›å•å…ƒæµ‹è¯•ã€‚ï¼‰
> 
> -   è¾¹ç•Œæƒ…å†µï¼šè¾¹ç•Œæƒ…å†µä¾§é‡äºæµ‹è¯•åº”ç”¨ä¸­çš„è¾¹ç•Œæ¡ä»¶ã€‚
> 

åˆ›å»ºå•å…ƒæµ‹è¯•æ—¶éœ€è¦æ³¨æ„**æµ‹è¯•å‡†åˆ™**ï¼š
> æœ‰æ•ˆçš„å•å…ƒæµ‹è¯•é€šå¸¸å…·æœ‰ä»¥ä¸‹å››ä¸ªå±æ€§ï¼š
> 
> -   æœ‰é’ˆå¯¹æ€§ï¼šæµ‹è¯•åº”ä¾§é‡äºæŸä¸ªå•å…ƒï¼Œä¾‹å¦‚ä¸€æ®µä»£ç ï¼Œé€šå¸¸æ˜¯æŸä¸ªç±»æˆ–æ–¹æ³•ã€‚æµ‹è¯•åº”æœ‰é’ˆå¯¹æ€§å¹¶ä¾§é‡äºéªŒè¯å•æ®µä»£ç çš„æ­£ç¡®æ€§ï¼Œè€Œä¸æ˜¯åŒæ—¶éªŒè¯å¤šæ®µä»£ç ã€‚
> -   æ˜“äºç†è§£ï¼šå½“æ‚¨é˜…è¯»ä»£ç æ—¶ï¼Œä»£ç åº”å½“ç®€å•ä¸”æ˜“äºç†è§£ã€‚å¼€å‘è€…åº”å½“èƒ½å¤Ÿç«‹å³ä¸€ç›®äº†ç„¶åœ°äº†è§£æµ‹è¯•èƒŒåçš„æ„å›¾ã€‚
> -   ç¡®å®šæ€§ï¼šåº”ä¿æŒä¸€è‡´çš„é€šè¿‡æˆ–å¤±è´¥ç»“æœã€‚å¦‚æœæ‚¨è¿è¡Œæµ‹è¯•å¤šæ¬¡ä¸”æ²¡æœ‰æ›´æ”¹ä»»ä½•ä»£ç ï¼Œæµ‹è¯•åº”å¾—åˆ°ç›¸åŒçš„ç»“æœã€‚æµ‹è¯•åº”é¿å…ä¸å¯é æ€§ï¼Œä¹Ÿå°±æ˜¯åœ¨æœªä¿®æ”¹ä»£ç çš„æƒ…å†µä¸‹ï¼Œä¸å¾—åœ¨ä¸€ä¸ªå®ä¾‹ä¸­æµ‹è¯•å¤±è´¥ï¼Œè€Œåœ¨å¦ä¸€ä¸ªå®ä¾‹ä¸­æµ‹è¯•é€šè¿‡ã€‚
> -   ç‹¬ç«‹æ€§ï¼šæµ‹è¯•ä¸éœ€è¦ä»»ä½•äººä¸ºäº’åŠ¨æˆ–è®¾ç½®ï¼Œå³å¯ç‹¬ç«‹è¿è¡Œã€‚

**å•å…ƒæµ‹è¯•éœ€è¦å…³å¿ƒä»£ç è¦†ç›–ç‡**ï¼šAndroid Studio ä¸ºæœ¬åœ°å•å…ƒæµ‹è¯•æä¾›äº†æµ‹è¯•è¦†ç›–ç‡å·¥å…·ï¼Œç”¨äºè·Ÿè¸ªå•å…ƒæµ‹è¯•æ‰€è¦†ç›–çš„åº”ç”¨ä»£ç çš„ç™¾åˆ†æ¯”å’ŒåŒºåŸŸã€‚

ä»£ç è¦†ç›–ç‡æœ‰åˆ†ææŠ¥å‘Šï¼Œå¦‚ï¼š
-   å•å…ƒæµ‹è¯•è¦†ç›–çš„æ–¹æ³•ç™¾åˆ†æ¯”ï¼šåˆ°ç›®å‰ä¸ºæ­¢æ‰€ç¼–å†™çš„æµ‹è¯•è¦†ç›–äº† 8 ç§æ–¹æ³•ä¸­çš„ 7 ç§ã€‚è¿™å æ–¹æ³•æ€»æ•°çš„ 87%ã€‚
-   å•å…ƒæµ‹è¯•è¦†ç›–çš„è¡Œæ•°ç™¾åˆ†æ¯”ï¼šç¼–å†™çš„æµ‹è¯•è¦†ç›–äº† 41 è¡Œä»£ç ä¸­çš„ 39 è¡Œã€‚è¿™å ä»£ç è¡Œçš„ 95%ã€‚

æ³¨æ„ï¼š**ä»£ç è¦†ç›–ç‡åªæ˜¯ç”¨æ¥æŸ¥æ‰¾æµ‹è¯•æœªè¦†ç›–çš„ä»£ç éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯åˆ©ç”¨ä»£ç è¦†ç›–ç‡æ¥è¡¡é‡ä»£ç è´¨é‡ã€‚**

å‚è€ƒæ–‡çŒ®
- [æœ¬åœ°å•å…ƒæµ‹è¯•å’Œæ’æ¡©æµ‹è¯•](https://developer.android.com/studio/test/test-in-android-studio?hl=zh-cn)
- [ä¸º ViewModel ç¼–å†™å•å…ƒæµ‹è¯•](https://developer.android.com/codelabs/basic-android-kotlin-compose-test-viewmodel?hl=zh-cn#0)
- [Androidå•å…ƒæµ‹è¯•ç ”ç©¶ä¸å®è·µ](https://tech.meituan.com/2015/12/24/android-unit-test.html)

#### monkeyæµ‹è¯•

Android Monkey æµ‹è¯•æ˜¯ä¸€ç§ç”¨äºè‡ªåŠ¨åŒ–åº”ç”¨ç¨‹åºçš„å‹åŠ›æµ‹è¯•å’Œéšæœºæµ‹è¯•çš„å·¥å…·ã€‚Monkey æµ‹è¯•å·¥å…·ä¼šåœ¨åº”ç”¨ç¨‹åºä¸Šæ‰§è¡Œå„ç§éšæœºäº‹ä»¶ï¼Œå¦‚ç‚¹å‡»ã€æ»‘åŠ¨ã€æŒ‰é”®ç­‰ï¼Œä»¥æ¨¡æ‹Ÿç”¨æˆ·çš„æ“ä½œè¡Œä¸ºã€‚è¿™äº›éšæœºäº‹ä»¶çš„ç›®çš„æ˜¯å‘ç°åº”ç”¨ç¨‹åºä¸­çš„æ½œåœ¨é—®é¢˜ï¼Œå¦‚å´©æºƒã€ANRï¼ˆåº”ç”¨ç¨‹åºæœªå“åº”ï¼‰å’Œå†…å­˜æ³„æ¼ç­‰ã€‚

åœ¨ä½¿ç”¨ Monkey æµ‹è¯•æ—¶ï¼Œå¯ä»¥æŒ‡å®šä¸€äº›å‚æ•°æ¥æ§åˆ¶æµ‹è¯•çš„æŒç»­æ—¶é—´ã€äº‹ä»¶æ•°é‡ç­‰ã€‚Monkey æµ‹è¯•ç”Ÿæˆçš„äº‹ä»¶åºåˆ—æ˜¯éšæœºçš„ï¼Œå› æ­¤å®ƒå¯ä»¥å‘ç°åº”ç”¨ç¨‹åºä¸­å¯èƒ½å­˜åœ¨çš„å„ç§é—®é¢˜ï¼Œå°¤å…¶æ˜¯åœ¨ç”¨æˆ·æ“ä½œæ–¹å¼æ— æ³•é¢„æµ‹çš„æƒ…å†µä¸‹ã€‚

Monkey æµ‹è¯•é€šè¿‡ä½¿ç”¨ adb å‘½ä»¤æ¥æ‰§è¡Œï¼š

```shell
$ adb shell monkey [options] <event-count>
```

æ¯”å¦‚ï¼šå»¶è¿Ÿ500æ¯«ç§’æ‰§è¡Œä¸€æ¬¡ï¼Œå…±æ‰§è¡Œ1000æ¬¡
```shell
$ adb shell monkey -p pkgname --throttle 500 -v -v -v 1000
```

Monkey æµ‹è¯•å®˜ç½‘ä»‹ç»ï¼š[UI/â€‹Application Exerciser Monkey](https://developer.android.com/studio/test/other-testing-tools/monkey)

#### å¼€å¯ä¸¥æ ¼æ¨¡å¼

Android StrictMode æ˜¯ä¸€ä¸ªå¼€å‘å·¥å…·ï¼Œèƒ½å¸®åŠ©å¼€å‘äººå‘˜æ£€æµ‹åº”ç”¨ç¨‹åºä¸­å¯èƒ½å­˜åœ¨çš„ä¸€äº›æ€§èƒ½å’Œè¿è§„é—®é¢˜ï¼Œå¦‚ç½‘ç»œè¯·æ±‚ã€ç£ç›˜æ“ä½œã€ä¸»çº¿ç¨‹è€—æ—¶ç­‰ã€‚

å¯ä»¥å‘ç°çš„é—®é¢˜åˆ†ä¸ºä»¥ä¸‹å‡ ç±»ï¼š

1.  ç£ç›˜è¯»å†™ï¼šæ£€æµ‹åº”ç”¨ä¸­æ˜¯å¦å­˜åœ¨åœ¨ä¸»çº¿ç¨‹è¿›è¡Œç£ç›˜è¯»å†™æ“ä½œçš„æƒ…å†µã€‚
2.  ç½‘ç»œè¯·æ±‚ï¼šæ£€æµ‹åº”ç”¨ä¸­æ˜¯å¦å­˜åœ¨åœ¨ä¸»çº¿ç¨‹è¿›è¡Œç½‘ç»œè¯·æ±‚çš„æƒ…å†µã€‚
3.  ä¸»çº¿ç¨‹è€—æ—¶æ“ä½œï¼šæ£€æµ‹åº”ç”¨ä¸­æ˜¯å¦å­˜åœ¨åœ¨ä¸»çº¿ç¨‹è¿›è¡Œè€—æ—¶æ“ä½œçš„æƒ…å†µï¼Œæ¯”å¦‚æ•°æ®åº“æŸ¥è¯¢ã€å¤§é‡è®¡ç®—ç­‰ã€‚
4.  å†…å­˜æ³„æ¼ï¼šæ£€æµ‹åº”ç”¨ä¸­æ˜¯å¦å­˜åœ¨å†…å­˜æ³„æ¼çš„æƒ…å†µï¼Œæ¯”å¦‚Activityæˆ–Fragmentæœªæ­£ç¡®é‡Šæ”¾ç­‰ã€‚

å¦‚æœé¡¹ç›®å¼€å¯äº†ä¸¥æ ¼æ¨¡å¼ï¼Œåœ¨ Logcat ä¸­æŸ¥çœ‹æ˜¯å¦æœ‰è‡ªå·±ç¼–å†™çš„ä»£ç ç›¸å…³çš„æ—¥å¿—ï¼Œå¦‚ï¼š

```java
androidx.fragment.app.strictmode.WrongFragmentContainerViolation

androidx.fragment.app.strictmode.SetUserVisibleHintViolation

android.os.strictmode.LeakedClosableViolation:

//......å…¶å®ƒ
```
å¦‚æœæ˜¯æ¯”è¾ƒä¸¥é‡çš„é—®é¢˜ï¼Œåº”è¯¥ä¿®å¤ã€‚

StrictMode å®˜ç½‘ä»‹ç»ï¼š[StrictMode](https://developer.android.com/reference/android/os/StrictMode)

#### ä¸ä¿æ´»æµ‹è¯•

Android ä¸­çš„"ä¸ä¿æ´»"æµ‹è¯•æŒ‡çš„æ˜¯åœ¨å¼€å‘è€…é€‰é¡¹ä¸­è®¾ç½®ä¸ä¿ç•™æ´»åŠ¨é€‰é¡¹ï¼Œå‹¾é€‰è¿™ä¸ªé€‰é¡¹åï¼Œåº”ç”¨ç¨‹åºé€€åˆ°åå°ä¼šè¢«ç³»ç»Ÿé”€æ¯ï¼Œè¿›å…¥å‰å°åä¼šé‡æ–°å¯åŠ¨ï¼Œæ‰€ä»¥è¿™ä¸»è¦æµ‹è¯•åº”ç”¨ç¨‹åºæ˜¯å¦èƒ½åœ¨é‡æ–°å¯åŠ¨çš„æƒ…å†µä¸‹æ­£ç¡®åœ°ä¿å­˜å’Œæ¢å¤çŠ¶æ€ã€‚

åœ¨è¿›è¡Œä¸ä¿æ´»æµ‹è¯•æ—¶ï¼Œå¯ä»¥æµ‹è¯•åº”ç”¨ç¨‹åºçš„å¯åŠ¨é€Ÿåº¦ã€æ•°æ®çš„ä¿å­˜å’Œæ¢å¤ã€ç”¨æˆ·ä½“éªŒç­‰æ–¹é¢çš„é—®é¢˜ã€‚

#### é™æ€ä»£ç æ£€æŸ¥

é¡¹ç›®å¼€å‘ä¸­ï¼Œé™æ€ä»£ç æ£€æŸ¥æ˜¯æœ‰å¿…è¦çš„ï¼Œå®ƒèƒ½é˜²æ­¢å‡ºç°ä½ç«¯é”™è¯¯é—®é¢˜ã€‚ä½†é™æ€ä»£ç æ£€æŸ¥å¯èƒ½ç”±äºé¡¹ç›®ç¯å¢ƒçš„åŸå› ï¼Œæ— æ³•é¡ºåˆ©è¿›è¡Œï¼Œå°¤å…¶éœ€è¦è¦åšçš„è¿˜æ˜¯å¢é‡é™æ€ä»£ç æ£€æŸ¥ã€‚

é¦–å…ˆï¼ŒAndroid Studio ä¸­æ ‡é»„è‰²è­¦å·çš„ä»£ç ä¸€å®šè¦é€ä¸€æŸ¥çœ‹å¹¶ä¿®æ”¹ã€‚

å…¶æ¬¡ï¼Œåœ¨ Android Studio ä¸­ï¼Œé€‰ä¸­ç±»æˆ–åŒ…ï¼Œè¿›è¡Œ Analyze &rarr; Inspect Code åˆ†ææ£€æŸ¥ã€‚

æœ€åï¼Œä½¿ç”¨ [detect](https://detekt.dev/) æˆ– [pmd](https://docs.pmd-code.org/latest/index.html) é™æ€ä»£ç å·¥å…·è¾…åŠ©è¿›è¡Œä»£ç æ£€æŸ¥ã€‚

ä¹‹å‰å†™äº†ä¸€ç¯‡æ–‡ç« ï¼š[Python å°è£… detekt å’Œ pmd å‘½ä»¤- å¢é‡é™æ€ä»£ç æ£€æŸ¥](https://juejin.cn/post/7336831338119020559)ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥æŸ¥çœ‹ã€‚

#### code review

code review æ˜¯ä»£ç ä¸Šçº¿å‰çš„æœ€åå¡å£ï¼Œä¸ºäº†é˜²æ­¢ä»£ç å‡ºç°çº¿ä¸Šé—®é¢˜ï¼ŒæŠŠæ§å¥½ä»£ç è´¨é‡ï¼Œæ¯ä¸ªå›¢é˜Ÿéƒ½æœŸæœ›æœ‰ä¸¥æ ¼çš„ code reviewã€‚ä½†åœ¨å®é™…å¼€å‘ä¸­ï¼Œè¦ä¹ˆæ²¡æœ‰ code reviewï¼Œè¦ä¹ˆ code review åªæ˜¯ä¸€ä¸ªè¿‡åœºã€‚å¦‚æœ code reivew èƒ½è¿›å…¥ç‰ˆæœ¬è¿­ä»£çš„æ ‡å‡†æµç¨‹èŠ‚ç‚¹ï¼Œé‚£ä¹ˆ code review æ˜¯å¾ˆå®¹æ˜“èƒ½å¤Ÿåœ¨å›¢é˜Ÿä¸­åŸ¹å…»èµ·æ¥çš„ã€‚

è¿™é‡Œä¸ä»‹ç» code review çš„å¥½å¤„å’Œåå¤„ï¼Œä»¥åŠå¦‚ä½•è¿›è¡Œ code reviewã€‚å¦‚æœæ„Ÿå…´è¶£ï¼Œå¯ä»¥æŸ¥çœ‹æ–‡æ¡£[what-is-code-review](https://about.gitlab.com/topics/version-control/what-is-code-review/)ã€‚

åœ¨å®é™…é¡¹ç›®å¼€å‘ä¸­ï¼Œé€šå¸¸é‡‡å–ç»“å¯¹ code review æ˜¯æœ€å¥½çš„å®è·µã€‚é¦–å…ˆï¼Œé€‰æ‹©ä¸€ä¸ªåŒäº‹åšä½ çš„ backupï¼Œå½“ç„¶ä½ ä¹Ÿåšä»–çš„ backupã€‚ä½† backup å‰ææ˜¯ï¼š
1. ä½ ä»¬ç†Ÿæ‚‰å½¼æ­¤çš„ä¸šåŠ¡
2. ä½ ä»¬çš„æŠ€æœ¯æ°´å¹³ç›¸å½“
3. ä½ ä»¬çš„ç¼–ç¨‹ä¹ æƒ¯ï¼Œä»£ç é£æ ¼ç›¸ä¼¼

åœ¨æ¯æ¬¡åˆå¹¶ä»£ç å‰ï¼Œä½ ä¿©ååœ¨ä¸€èµ·ï¼Œä¸€ä¸ªè´Ÿè´£è§£è¯´ä»£ç ï¼Œè¿™éƒ¨åˆ†ä»£ç æ˜¯åšä»€ä¹ˆç”¨çš„ï¼Œä¸ºä»€ä¹ˆè¿™æ ·åšï¼ŒæŠŠä»£ç çš„é€»è¾‘å’Œæ€è·¯å‘Šè¯‰ä½ çš„ reviewerï¼Œreviewer è´Ÿè´£å¯¹ä»£ç æå‡ºå»ºè®®å’Œåé¦ˆï¼Œç›´åˆ°ä½ ä»¬åŒæ–¹å¯¹è¿™æ¬¡æ›´æ”¹ä»£ç è¾¾æˆå…±è¯†ï¼Œç„¶åæ‰åˆå¹¶ä»£ç ã€‚

### abå¼€å…³
ç°åœ¨æ¯ä¸ªå…¬å¸éƒ½æœ‰ apm å¹³å°ï¼Œå½“è§‚æµ‹åˆ°çº¿ä¸Šä»£ç å‡ºç°äº†é—®é¢˜ï¼Œå¯ä»¥é€šè¿‡ ab å¼€å…³åŠæ—¶æ­¢æŸï¼Œè¿™æ˜¯éå¸¸é‡è¦çš„ä¸€ç¯ã€‚

åªæœ‰ä¸Šé¢çš„æ“ä½œæ­¥éª¤éƒ½å¤±æ•ˆäº†ï¼Œab å¼€å…³æ‰èƒ½å‡ºç°ï¼Œæ‰€ä»¥æ·»åŠ  ab å¼€å…³å¾—æ…é‡ã€‚ä½†é¢„ç•™æœ‰ ab å¼€å…³æ€»æ˜¯å¥½çš„ï¼Œé‚£ä¹ˆä»€ä¹ˆåœºæ™¯ä¸‹é€‚åˆæ·»åŠ  ab å¼€å…³å‘¢ï¼Ÿ

é€‚åˆæ·»åŠ  ab å¼€å…³çš„åœºæ™¯ï¼ˆä¸èƒ½å®Œå…¨æŒæ§çš„åœºæ™¯ï¼‰ï¼Œå¦‚ï¼š
1. ä¿®æ”¹å½±å“å¤šä¸ªä¸šåŠ¡æ–¹ï¼Œä¸èƒ½æŠŠæ§
2. éœ€æ±‚è¾ƒå¤§ï¼ˆè¿­ä»£å‘¨æœŸæ¨ªè·¨å¤šä¸ªç‰ˆæœ¬ï¼‰ï¼Œç¬¬ä¸€æ¬¡ä¸Šçº¿
3. é‡æ„ä»£ç 
4. åœ¨ä¸ç†Ÿæ‚‰çš„è€ä¸šåŠ¡ä¸­å¢åŠ æ–°çš„ feature
5. äº§å“æˆ–æ•°æ®åˆ†ææˆ–è€æ¿æ¯”è¾ƒå…³å¿ƒçš„ä¸šåŠ¡æ›´æ”¹ï¼šç™»å½•ã€æ¨é€ã€æ•°æ®åŸ‹ç‚¹ç­‰

æ·»åŠ  ab å¼€å…³éœ€è¦åšåˆ°ä»£ç éš”ç¦»ï¼Œå¦‚æœå‘½ä¸­æ»¡è¶³æ¡ä»¶ï¼ˆapp ç‰ˆæœ¬ã€ç³»ç»Ÿç‰ˆæœ¬ã€æœºå‹ç­‰ï¼‰çš„ç”¨æˆ·ï¼Œå°±èµ°æ–°çš„é€»è¾‘ï¼Œå¦åˆ™èµ°è€çš„é€»è¾‘ã€‚æ·»åŠ  ab å¼€å…³è¦èƒ½å¤Ÿæ§åˆ¶ä»£ç åˆ†æµï¼Œæ— è®ºæ˜¯ä¿®æ”¹è¿˜æ˜¯æ–°å¢ä»£ç ã€‚

```java
public void runAB() {
    boolean isNew = config();
    if (isNew) {
        //èµ°æ–°çš„é€»è¾‘
        newCode();
    } else {
        //èµ°è€çš„é€»è¾‘
        oldCode();
    }
}
```

## æ€»ç»“
ä¸Šé¢ä»è¾“å…¥éªŒè¯ã€è¾“å‡ºéªŒè¯ã€å¼‚å¸¸ã€æ—¥å¿—ã€æµ‹è¯•ä¿éšœã€ab å¼€å…³æ–¹é¢ï¼Œåˆ†æäº†é˜²å¾¡æ€§ç¼–ç¨‹åº”è¯¥æ€ä¹ˆåšï¼Œé˜²å¾¡æ€§ç¼–ç¨‹çš„ç›®çš„å§‹ç»ˆæ˜¯æé«˜ä»£ç è´¨é‡ï¼Œé™ä½çº¿ä¸Šå‡ºç°é—®é¢˜çš„æ¦‚ç‡ã€‚åªæœ‰ä»£ç æ²¡æœ‰é—®é¢˜äº†ï¼Œæ‰æœ‰æ›´å¤šçš„æ—¶é—´å’Œç²¾åŠ›å»åšæ›´é‡è¦çš„äº‹æƒ…ã€‚æ‰€ä»¥ï¼Œä¸“æ³¨äºå†™é«˜è´¨é‡ä»£ç ï¼Œå°†å½¢æˆä¸€ä¸ªæ­£åé¦ˆï¼Œå¸¦æ¥è‰¯æ€§å¾ªç¯ã€‚

